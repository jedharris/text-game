# Phase 2: Aldric's Fungal Infection (NPC Damage via Progression)
# Tests that NPC infections with progression_rate correctly update damage_per_turn

# Initial state: Check Aldric's infection
# He starts at severity 80 with progression_rate 2, damage_per_turn 10
ASSERT actors.npc_aldric.properties.conditions.fungal_infection.severity == 80
ASSERT actors.npc_aldric.properties.conditions.fungal_infection.progression_rate == 2
ASSERT actors.npc_aldric.properties.conditions.fungal_infection.damage_per_turn == 10

# Check Aldric's initial health
ASSERT actors.npc_aldric.properties.health == 40
ASSERT actors.npc_aldric.properties.max_health == 100

# Advance 5 turns to see progression and damage
# Each turn: severity +2 (progression_rate), damage -10, regen +5, net -5 HP
look
look
look
look
look

# After 5 turns:
# - Severity: 80 + (2*5) = 90, still in tier 80+ (damage=10)
# - Health: 40 - (5*5) = 40 - 25 = 15 HP
ASSERT actors.npc_aldric.properties.conditions.fungal_infection.severity == 90
ASSERT actors.npc_aldric.properties.conditions.fungal_infection.damage_per_turn == 10
ASSERT actors.npc_aldric.properties.health <= 16
ASSERT actors.npc_aldric.properties.health >= 14

# Advance 2 more turns to reach severity cap
# Aldric will die around turn 8 (40 HP / 5 net damage = 8 turns)
look
look

# After 7 turns total:
# - Severity: 90 + (2*2) = 94
# - Health: 15 - (5*2) = 5 HP (very close to death)
ASSERT actors.npc_aldric.properties.conditions.fungal_infection.severity == 94
ASSERT actors.npc_aldric.properties.conditions.fungal_infection.damage_per_turn == 10
ASSERT actors.npc_aldric.properties.health <= 6
ASSERT actors.npc_aldric.properties.health >= 4

# Advance 2 more turns to witness Aldric's death
# Turn 8: 5 - 5 = 0 HP (death)
look
look

# After 9 turns total:
# - Aldric should be dead (removed from actors dict)
# - Death from fungal infection validated
# Note: Dead NPCs are removed from state.actors, so we can't check health directly
# The "Scholar Aldric has been slain!" message validates death occurred
